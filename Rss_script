-- ⚽ Realistic Street Soccer – GK Hitbox Hub (Delta X)

local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local lp = Players.LocalPlayer

-- ========= НАСТРОЙКИ =========
local Settings = {
    Enabled      = true,      -- сразу включён
    RadiusMode   = "Front",   -- пока фронтальный щит
    Power        = 110,       -- сила отражения
    Cooldown     = 0.20,      -- задержка между сейвами
    ShowRadius   = true,      -- показывать щит
    RadiusColor  = Color3.fromRGB(0, 255, 0),
    RadiusAlpha  = 0.6,       -- 0 = прозрачный, 1 = плотный
    RadiusSize   = 14         -- ширина/высота зоны кипера
}

local lastKick = 0

-- ========= ПОИСК МЯЧА В ТВОЕЙ ИГРЕ =========
local function getBall()
    if workspace:FindFirstChild("ball") then
        local root = workspace.ball
        if root:FindFirstChild("Ball") and root.Ball:IsA("BasePart") then
            return root.Ball
        end
        if root:FindFirstChild("TouchBall") and root.TouchBall:IsA("BasePart") then
            return root.TouchBall
        end
    end
    for _, obj in ipairs(workspace:GetDescendants()) do
        if obj:IsA("BasePart") and obj.Name:lower() == "ball" then
            return obj
        end
    end
    return nil
end

-- ========= СОЗДАЁМ ЩИТ (СПЛЮСНУТЫЙ ХИТБОКС) =========
local function createShield()
    local p = Instance.new("Part")
    p.Name = "GK_Shield"
    p.Anchored = true
    p.CanCollide = false
    p.Massless = true
    p.Color = Settings.RadiusColor
    p.Material = Enum.Material.ForceField
    p.Transparency = 1
    p.Parent = workspace
    return p
end

local shield = createShield()

local function updateShieldVisible()
    if not shield then return end
    if Settings.ShowRadius and Settings.Enabled then
        shield.Transparency = 1 - Settings.RadiusAlpha
    else
        shield.Transparency = 1
    end
end

-- ========= ОБНОВЛЯЕМ ПОЗИЦИЮ И РАЗМЕР ЩИТА =========
local function updateShield()
    local char = lp.Character
    local root = char and char:FindFirstChild("HumanoidRootPart")
    if not root or not shield then return end

    local radius = Settings.RadiusSize          -- ширина по X
    local thickness = 1.5                       -- толщина по Z
    local height = radius * 1.2                 -- высота щита

    local offset = CFrame.new(0, 0, -2)         -- щит чуть перед кипером

    local size = Vector3.new(radius * 2, height, thickness)
    if shield.Size ~= size then
        shield.Size = size
    end

    shield.CFrame = root.CFrame * offset
    updateShieldVisible()

    return shield.CFrame, radius
end

-- ========= ЛОГИКА СЕЙВА: МЯЧ ОТЛЕТАЕТ ОТ ЩИТА =========
RunService.Heartbeat:Connect(function()
    if not Settings.Enabled then
        updateShieldVisible()
        return
    end

    local cframe, radius = updateShield()
    if not cframe or not radius then return end

    local ball = getBall()
    local char = lp.Character
    local root = char and char:FindFirstChild("HumanoidRootPart")
    if not (ball and root) then return end

    local now = tick()
    if now - lastKick < Settings.Cooldown then return end

    -- Локальная позиция мяча относительно щита
    local localPos = cframe:PointToObjectSpace(ball.Position)

    local halfX = radius
    local halfY = radius
    local halfZ = shield.Size.Z / 2 + ball.Size.Z / 2

    local inX = math.abs(localPos.X) <= halfX
    local inY = math.abs(localPos.Y) <= halfY
    local inZ = math.abs(localPos.Z) <= halfZ

    if inX and inY and inZ then
        lastKick = now

        local v = ball.AssemblyLinearVelocity
        local normal = cframe.LookVector

        -- отражение скорости от щита
        local dot = v:Dot(normal)
        local reflected = v - 2 * dot * normal

        -- немного вверх, чтобы не в землю
        reflected = reflected + Vector3.new(0, 5, 0)

        local targetPower = math.clamp(Settings.Power, 50, 140)
        if reflected.Magnitude < targetPower then
            reflected = reflected.Unit * targetPower
        end

        ball.AssemblyLinearVelocity = reflected
    end
end)

-- ========= МЕНЮ =========
local ScreenGui = Instance.new("ScreenGui")
ScreenGui.Name = "GK_HitboxHub"
ScreenGui.ResetOnSpawn = false
ScreenGui.Parent = game.CoreGui

local Frame = Instance.new("Frame")
Frame.Size = UDim2.new(0, 230, 0, 240)
Frame.Position = UDim2.new(0.03, 0, 0.25, 0)
Frame.BackgroundColor3 = Color3.fromRGB(15, 15, 25)
Frame.BackgroundTransparency = 0.1
Frame.BorderSizePixel = 0
Frame.Active = true
Frame.Draggable = true
Frame.Parent = ScreenGui

local fc = Instance.new("UICorner", Frame)
fc.CornerRadius = UDim.new(0, 12)
local fs = Instance.new("UIStroke", Frame)
fs.Thickness = 2
fs.Color = Color3.fromRGB(0, 200, 255)

local Title = Instance.new("TextLabel")
Title.Size = UDim2.new(1, -10, 0, 28)
Title.Position = UDim2.new(0, 5, 0, 5)
Title.BackgroundTransparency = 1
Title.Text = "GK Hitbox Hub"
Title.Font = Enum.Font.GothamBold
Title.TextScaled = true
Title.TextColor3 = Color3.fromRGB(255, 255, 255)
Title.Parent = Frame

local function makeBtn(text, y, cb)
    local b = Instance.new("TextButton")
    b.Size = UDim2.new(1, -20, 0, 30)
    b.Position = UDim2.new(0, 10, 0, y)
    b.BackgroundColor3 = Color3.fromRGB(50, 50, 70)
    b.Text = text
    b.Font = Enum.Font.GothamMedium
    b.TextScaled = true
    b.TextColor3 = Color3.fromRGB(255, 255, 255)
    b.AutoButtonColor = false
    b.Parent = Frame
    local c = Instance.new("UICorner", b)
    c.CornerRadius = UDim.new(0, 8)
    b.MouseButton1Click:Connect(function() cb(b) end)
    return b
end

-- ON/OFF
makeBtn("Hitbox: ON", 40, function(btn)
    Settings.Enabled = not Settings.Enabled
    btn.Text = Settings.Enabled and "Hitbox: ON" or "Hitbox: OFF"
    btn.BackgroundColor3 = Settings.Enabled and Color3.fromRGB(0, 200, 100) or Color3.fromRGB(50, 50, 70)
    updateShieldVisible()
end)

-- Режим (на будущее, можно оставить для совместимости)
makeBtn("Mode: Front", 80, function(btn)
    Settings.RadiusMode = (Settings.RadiusMode == "Front") and "Circle" or "Front"
    btn.Text = "Mode: " .. Settings.RadiusMode
end)

-- Сила
makeBtn("Power: "..Settings.Power, 120, function(btn)
    local steps = {80, 100, 110, 120, 140}
    local i = 1
    for n, v in ipairs(steps) do
        if v == Settings.Power then i = n break end
    end
    i = i % #steps + 1
    Settings.Power = steps[i]
    btn.Text = "Power: "..Settings.Power
end)

-- Размер щита
makeBtn("Size: "..Settings.RadiusSize, 160, function(btn)
    local steps = {10, 12, 14, 16, 18}
    local i = 1
    for n, v in ipairs(steps) do
        if v == Settings.RadiusSize then i = n break end
    end
    i = i % #steps + 1
    Settings.RadiusSize = steps[i]
    btn.Text = "Size: "..Settings.RadiusSize
end)

-- Показ/скрытие щита
makeBtn("Shield Vis: ON", 200, function(btn)
    Settings.ShowRadius = not Settings.ShowRadius
    btn.Text = "Shield Vis: "..(Settings.ShowRadius and "ON" or "OFF")
    updateShieldVisible()
end)

print("✅ GK Hitbox Hub загружен. Включи Hitbox и настрой Size/Power под себя.")
