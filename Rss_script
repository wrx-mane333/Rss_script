-- ⚽ Hitbox Control (Fixed & Optimized)

local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local UserInputService = game:GetService("UserInputService")
local lp = Players.LocalPlayer

-- ========= SETTINGS =========
local Settings = {
    Enabled = false,
    Power = 85,
    Cooldown = 0.2, -- Немного уменьшил задержку для плавности
    HitboxSize = 12,
    MaxHitboxSize = 35
}

local lastKick = 0

-- ========= BALL FINDER =========
-- Улучшенный поиск мяча: ищет детали с именем Ball или TouchBall
local function getBall()
    for _, obj in ipairs(workspace:GetChildren()) do
        if obj:IsA("BasePart") and (obj.Name:lower():find("ball")) then
            return obj
        end
    end
    return nil
end

-- ========= HITBOX SPHERE =========
-- Удаляем старую сферу, если она осталась от прошлого запуска
if workspace:FindFirstChild("HitboxSphere_System") then
    workspace.HitboxSphere_System:Destroy()
end

local sphere = Instance.new("Part")
sphere.Name = "HitboxSphere_System"
sphere.Shape = Enum.PartType.Ball
sphere.Anchored = true
sphere.CanCollide = false
sphere.CastShadow = false
sphere.Material = Enum.Material.ForceField
sphere.Color = Color3.fromRGB(0, 255, 120)
sphere.Transparency = 1
sphere.Parent = workspace

local function updateSphere()
    sphere.Size = Vector3.new(Settings.HitboxSize, Settings.HitboxSize, Settings.HitboxSize)
    sphere.Transparency = Settings.Enabled and 0.5 or 1
end

-- ========= HIT LOGIC =========
RunService.Heartbeat:Connect(function()
    if not Settings.Enabled then return end

    local char = lp.Character
    local root = char and char:FindFirstChild("HumanoidRootPart")
    if not root then return end

    -- Сфера летит чуть впереди игрока
    sphere.CFrame = root.CFrame * CFrame.new(0, 0, -2)

    local ball = getBall()
    if not ball then return end
    if tick() - lastKick < Settings.Cooldown then return end

    -- Дистанция до мяча
    local dist = (ball.Position - sphere.Position).Magnitude
    if dist <= (Settings.HitboxSize / 2) then
        lastKick = tick()
        
        -- Направление удара (вперед от игрока + немного вверх)
        local dir = (ball.Position - root.Position).Unit
        ball.AssemblyLinearVelocity = (dir * Settings.Power) + Vector3.new(0, Settings.Power / 4, 0)
    end
end)

-- ========= UI SETUP =========
local gui = Instance.new("ScreenGui")
gui.Name = "SimpleHitboxUI"
-- Пробуем вставить в CoreGui (для читов), если не выйдет - в PlayerGui
local success, err = pcall(function() gui.Parent = game:GetService("CoreGui") end)
if not success then gui.Parent = lp:WaitForChild("PlayerGui") end

-- Главная кнопка-переключатель
local toggleBtn = Instance.new("TextButton", gui)
toggleBtn.Size = UDim2.fromOffset(50, 50)
toggleBtn.Position = UDim2.fromOffset(20, 150)
toggleBtn.BackgroundColor3 = Color3.fromRGB(40, 40, 50)
toggleBtn.Text = "⚽"
toggleBtn.TextSize = 25
toggleBtn.TextColor3 = Color3.new(1, 1, 1)

local btnCorner = Instance.new("UICorner", toggleBtn)
btnCorner.CornerRadius = UDim.new(1, 0)

-- Меню
local menu = Instance.new("Frame", gui)
menu.Size = UDim2.fromOffset(180, 160)
menu.Position = UDim2.new(0, 80, 0, 150)
menu.BackgroundColor3 = Color3.fromRGB(30, 30, 40)
menu.Visible = false

local menuCorner = Instance.new("UICorner", menu)
menuCorner.CornerRadius = UDim.new(0, 10)

-- Заголовок
local title = Instance.new("TextLabel", menu)
title.Size = UDim2.new(1, 0, 0, 35)
title.BackgroundTransparency = 1
title.Text = "HITBOX MENU"
title.Font = Enum.Font.GothamBold
title.TextColor3 = Color3.new(1, 1, 1)

-- Кнопка Вкл/Выкл
local statusBtn = Instance.new("TextButton", menu)
statusBtn.Size = UDim2.new(0.8, 0, 0, 35)
statusBtn.Position = UDim2.new(0.1, 0, 0, 45)
statusBtn.Font = Enum.Font.GothamBold
statusBtn.TextSize = 14
statusBtn.TextColor3 = Color3.new(1, 1, 1)

local statusCorner = Instance.new("UICorner", statusBtn)

-- Слайдер размера
local sizeText = Instance.new("TextLabel", menu)
sizeText.Size = UDim2.new(1, 0, 0, 20)
sizeText.Position = UDim2.new(0, 0, 0, 90)
sizeText.BackgroundTransparency = 1
sizeText.TextColor3 = Color3.new(1, 1, 1)
sizeText.Font = Enum.Font.Gotham

local sliderBg = Instance.new("Frame", menu)
sliderBg.Size = UDim2.new(0.8, 0, 0, 8)
sliderBg.Position = UDim2.new(0.1, 0, 0, 120)
sliderBg.BackgroundColor3 = Color3.fromRGB(60, 60, 70)

local sliderFill = Instance.new("Frame", sliderBg)
sliderFill.Size = UDim2.new(0.5, 0, 1, 0)
sliderFill.BackgroundColor3 = Color3.fromRGB(0, 255, 150)

-- ========= FUNCTIONS =========
local function updateUI()
    if Settings.Enabled then
        statusBtn.Text = "STATUS: ON"
        statusBtn.BackgroundColor3 = Color3.fromRGB(0, 180, 100)
    else
        statusBtn.Text = "STATUS: OFF"
        statusBtn.BackgroundColor3 = Color3.fromRGB(180, 50, 50)
    end
    sizeText.Text = "Hitbox Size: " .. Settings.HitboxSize
    sliderFill.Size = UDim2.new(Settings.HitboxSize / Settings.MaxHitboxSize, 0, 1, 0)
    updateSphere()
end

-- Логика слайдера (Исправлено)
local isDragging = false
local function updateSlider(input)
    local relativeX = math.clamp((input.Position.X - sliderBg.AbsolutePosition.X) / sliderBg.AbsoluteSize.X, 0, 1)
    Settings.HitboxSize = math.floor(relativeX * Settings.MaxHitboxSize)
    if Settings.HitboxSize < 2 then Settings.HitboxSize = 2 end
    updateUI()
end

sliderBg.InputBegan:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
        isDragging = true
        updateSlider(input)
    end
end)

UserInputService.InputChanged:Connect(function(input)
    if isDragging and (input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch) then
        updateSlider(input)
    end
end)

UserInputService.InputEnded:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
        isDragging = false
    end
end)

statusBtn.MouseButton1Click:Connect(function()
    Settings.Enabled = not Settings.Enabled
    updateUI()
end)

toggleBtn.MouseButton1Click:Connect(function()
    menu.Visible = not menu.Visible
end)

-- Начальный запуск
updateUI()
print("✅ Script Loaded! Ball search active.")
