local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local UserInputService = game:GetService("UserInputService")
local lp = Players.LocalPlayer

-- ========= SETTINGS =========
local Settings = {
    Enabled = false,
    Power = 80,
    Cooldown = 0.25,
    HitboxSize = 12,
    MaxHitboxSize = 35
}

local lastKick = 0
local draggingSlider = false

-- ========= BALL =========
local function getBall()
    return workspace:FindFirstChild("ball") or workspace:FindFirstChild("TouchBall")
end

-- ========= HITBOX LOGIC =========
local sphere = Instance.new("Part")
sphere.Shape = Enum.PartType.Ball
sphere.Anchored = true
sphere.CanCollide = false
sphere.Material = Enum.Material.ForceField
sphere.Color = Color3.fromRGB(0, 255, 120)
sphere.Transparency = 1
sphere.Parent = workspace

local function updateSphere()
    sphere.Size = Vector3.new(Settings.HitboxSize, Settings.HitboxSize, Settings.HitboxSize)
    sphere.Transparency = Settings.Enabled and 0.5 or 1
end

updateSphere()

RunService.Heartbeat:Connect(function()
    if not Settings.Enabled then 
        sphere.Transparency = 1
        return 
    end

    local char = lp.Character
    local root = char and char:FindFirstChild("HumanoidRootPart")
    if not root then return end

    -- Позиция хитбокса перед игроком
    sphere.CFrame = root.CFrame * CFrame.new(0, 0, -3)
    sphere.Transparency = 0.5

    local ball = getBall()
    if not ball or not ball:IsA("BasePart") then return end
    if tick() - lastKick < Settings.Cooldown then return end

    if (ball.Position - sphere.Position).Magnitude <= (Settings.HitboxSize / 2) then
        lastKick = tick()
        -- Вектор удара
        local dir = (ball.Position - root.Position + Vector3.new(0, 1, 0)).Unit
        ball.AssemblyLinearVelocity = dir * Settings.Power + Vector3.new(0, 18, 0)
    end
end)

-- ========= UI SYSTEM =========

-- Удаляем старый UI если есть
if game.CoreGui:FindFirstChild("HitboxMobileUI") then
    game.CoreGui.HitboxMobileUI:Destroy()
end

local ScreenGui = Instance.new("ScreenGui")
ScreenGui.Name = "HitboxMobileUI"
ScreenGui.Parent = game.CoreGui

-- 1. КНОПКА ОТКРЫТИЯ (MINI BUTTON)
local OpenButton = Instance.new("TextButton")
OpenButton.Name = "OpenButton"
OpenButton.Parent = ScreenGui
OpenButton.Size = UDim2.fromOffset(50, 50)
OpenButton.Position = UDim2.new(0, 20, 0.4, 0) -- Слева по центру
OpenButton.BackgroundColor3 = Color3.fromRGB(30, 30, 35)
OpenButton.TextColor3 = Color3.fromRGB(0, 255, 120)
OpenButton.Text = "⚽"
OpenButton.TextSize = 24
OpenButton.Font = Enum.Font.GothamBold
OpenButton.BorderSizePixel = 0
Instance.new("UICorner", OpenButton).CornerRadius = UDim.new(0, 12)
Instance.new("UIStroke", OpenButton).Color = Color3.fromRGB(60, 60, 60)

-- 2. ГЛАВНАЯ ПАНЕЛЬ
local MainFrame = Instance.new("Frame")
MainFrame.Name = "MainFrame"
MainFrame.Parent = ScreenGui
MainFrame.Size = UDim2.fromOffset(220, 260) -- Чуть больше для удобства пальцев
MainFrame.Position = UDim2.new(0.5, -110, 0.5, -130) -- Центр экрана
MainFrame.BackgroundColor3 = Color3.fromRGB(20, 20, 25)
MainFrame.BorderSizePixel = 0
MainFrame.Visible = false -- Скрыта по умолчанию
Instance.new("UICorner", MainFrame).CornerRadius = UDim.new(0, 16)

-- Dragging logic for PC/Mobile
local dragging, dragInput, dragStart, startPos
MainFrame.InputBegan:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
        dragging = true
        dragStart = input.Position
        startPos = MainFrame.Position
        
        input.Changed:Connect(function()
            if input.UserInputState == Enum.UserInputState.End then
                dragging = false
            end
        end)
    end
end)

MainFrame.InputChanged:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch then
        dragInput = input
    end
end)

UserInputService.InputChanged:Connect(function(input)
    if input == dragInput and dragging then
        local delta = input.Position - dragStart
        MainFrame.Position = UDim2.new(startPos.X.Scale, startPos.X.Offset + delta.X, startPos.Y.Scale, startPos.Y.Offset + delta.Y)
    end
end)

-- Title
local Title = Instance.new("TextLabel", MainFrame)
Title.Size = UDim2.new(1, -40, 0, 40)
Title.Position = UDim2.new(0, 15, 0, 0)
Title.BackgroundTransparency = 1
Title.Text = "HITBOX CONTROL"
Title.Font = Enum.Font.GothamBlack
Title.TextColor3 = Color3.fromRGB(255, 255, 255)
Title.TextSize = 18
Title.TextXAlignment = Enum.TextXAlignment.Left

-- Close Button (X) inside panel
local CloseBtn = Instance.new("TextButton", MainFrame)
CloseBtn.Size = UDim2.fromOffset(30, 30)
CloseBtn.Position = UDim2.new(1, -35, 0, 5)
CloseBtn.BackgroundTransparency = 1
CloseBtn.Text = "X"
CloseBtn.TextColor3 = Color3.fromRGB(200, 50, 50)
CloseBtn.Font = Enum.Font.GothamBold
CloseBtn.TextSize = 18

CloseBtn.MouseButton1Click:Connect(function()
    MainFrame.Visible = false
    OpenButton.Visible = true
end)

OpenButton.MouseButton1Click:Connect(function()
    MainFrame.Visible = true
    OpenButton.Visible = false
end)

-- TOGGLE BUTTON (BIG)
local ToggleBtn = Instance.new("TextButton", MainFrame)
ToggleBtn.Size = UDim2.new(1, -30, 0, 50)
ToggleBtn.Position = UDim2.new(0, 15, 0, 50)
ToggleBtn.Font = Enum.Font.GothamBold
ToggleBtn.TextSize = 18
ToggleBtn.TextColor3 = Color3.new(1, 1, 1)
Instance.new("UICorner", ToggleBtn).CornerRadius = UDim.new(0, 8)

local function updateUI()
    if Settings.Enabled then
        ToggleBtn.Text = "STATUS: ACTIVE"
        ToggleBtn.BackgroundColor3 = Color3.fromRGB(0, 200, 100)
    else
        ToggleBtn.Text = "STATUS: DISABLED"
        ToggleBtn.BackgroundColor3 = Color3.fromRGB(60, 60, 70)
    end
    updateSphere()
end

ToggleBtn.MouseButton1Click:Connect(function()
    Settings.Enabled = not Settings.Enabled
    updateUI()
end)

-- SLIDER AREA
local SizeLabel = Instance.new("TextLabel", MainFrame)
SizeLabel.Position = UDim2.new(0, 15, 0, 120)
SizeLabel.Size = UDim2.new(1, -30, 0, 20)
SizeLabel.BackgroundTransparency = 1
SizeLabel.Text = "SIZE: " .. Settings.HitboxSize
SizeLabel.TextColor3 = Color3.fromRGB(180, 180, 180)
SizeLabel.Font = Enum.Font.Gotham
SizeLabel.TextSize = 14
SizeLabel.TextXAlignment = Enum.TextXAlignment.Left

local SliderBg = Instance.new("TextButton", MainFrame) -- Using TextButton for easier input handling
SliderBg.Name = "SliderBg"
SliderBg.Text = ""
SliderBg.AutoButtonColor = false
SliderBg.Position = UDim2.new(0, 15, 0, 150)
SliderBg.Size = UDim2.new(1, -30, 0, 24) -- Толще для пальцев
SliderBg.BackgroundColor3 = Color3.fromRGB(50, 50, 60)
Instance.new("UICorner", SliderBg).CornerRadius = UDim.new(1, 0)

local SliderFill = Instance.new("Frame", SliderBg)
SliderFill.Size = UDim2.new(Settings.HitboxSize / Settings.MaxHitboxSize, 0, 1, 0)
SliderFill.BackgroundColor3 = Color3.fromRGB(0, 255, 120)
Instance.new("UICorner", SliderFill).CornerRadius = UDim.new(1, 0)

-- MOBILE FRIENDLY SLIDER LOGIC
local function updateSlider(input)
    local sliderPos = SliderBg.AbsolutePosition
    local sliderSize = SliderBg.AbsoluteSize
    local inputX = input.Position.X
    
    local relativeX = inputX - sliderPos.X
    local scale = math.clamp(relativeX / sliderSize.X, 0, 1)
    
    Settings.HitboxSize = math.floor(scale * Settings.MaxHitboxSize)
    if Settings.HitboxSize < 2 then Settings.HitboxSize = 2 end -- Min limit
    
    SliderFill.Size = UDim2.new(scale, 0, 1, 0)
    SizeLabel.Text = "SIZE: " .. Settings.HitboxSize
    updateSphere()
end

SliderBg.InputBegan:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
        draggingSlider = true
        updateSlider(input)
    end
end)

SliderBg.InputEnded:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
        draggingSlider = false
    end
end)

UserInputService.InputChanged:Connect(function(input)
    if draggingSlider and (input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch) then
        updateSlider(input)
    end
end)

-- Credits
local Credit = Instance.new("TextLabel", MainFrame)
Credit.Size = UDim2.new(1, 0, 0, 20)
Credit.Position = UDim2.new(0, 0, 1, -25)
Credit.BackgroundTransparency = 1
Credit.Text = "Modified for Mobile"
Credit.TextColor3 = Color3.fromRGB(80, 80, 80)
Credit.Font = Enum.Font.Gotham
Credit.TextSize = 12

updateUI()
print("✅ Mobile Hitbox UI Loaded")
