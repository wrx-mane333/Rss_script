local Rayfield = loadstring(game:HttpGet('https://sirius.menu/rayfield'))()

local Window = Rayfield:CreateWindow({
    Name = "RSS | Hitbox Magnet (Fixed + Visualizer)",
    LoadingTitle = "–ó–∞–≥—Ä—É–∑–∫–∞ Hitbox Magnet...",
    LoadingSubtitle = "Improved by Replit Agent",
    ConfigurationSaving = { Enabled = false }
})

local Tab = Window:CreateTab("üß≤ Hitbox", 4483362458)
local TabGK = Window:CreateTab("ü•Ö –í—Ä–∞—Ç–∞—Ä—å", 4483362458)

-- –ù–∞—Å—Ç—Ä–æ–π–∫–∏
local Settings = {
    HitboxEnabled = false,
    VisualizerEnabled = true,
    HitboxRadius = 8,
    HitboxStrength = 80,
    HitboxUseBodyVelocity = true,
    PerBallCooldown = 0.35,
    GKMode = true,
    GK_SaveSpeed = 140,
    GK_MinBallSpeed = 15,
    GK_DotThreshold = 0.7,
    GK_MaxDistanceToAttempt = 18
}

local RunService = game:GetService("RunService")
local Players = game:GetService("Players")
local LocalPlayer = Players.LocalPlayer
local workspace = game:GetService("Workspace")

local hitboxPart = nil
local activeBV = {}
local perBallLast = {}
local connection = nil

-- –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–∏—Å–∫–∞ –º—è—á–∞
local function isBall(part)
    local name = part.Name:lower()
    return name:find("ball") or name:find("soccer") or name:find("balloon")
end

-- –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Å–∫–æ—Ä–æ—Å—Ç–∏ –º—è—á–∞
local function getBallVelocity(ball)
    local success, velocity = pcall(function()
        return ball.AssemblyLinearVelocity
    end)
    return success and velocity or Vector3.new(0, 0, 0)
end

local function createHitbox()
    if hitboxPart then 
        hitboxPart:Destroy() 
        hitboxPart = nil
    end
    
    hitboxPart = Instance.new("Part")
    hitboxPart.Name = "RSS_Hitbox"
    hitboxPart.Anchored = true
    hitboxPart.CanCollide = false
    hitboxPart.Transparency = Settings.VisualizerEnabled and 0.5 or 1
    hitboxPart.Color = Color3.fromRGB(255, 0, 0)
    hitboxPart.Size = Vector3.new(Settings.HitboxRadius * 2, Settings.HitboxRadius * 2, Settings.HitboxRadius * 2)
    hitboxPart.Shape = Enum.PartType.Ball
    hitboxPart.Material = Enum.Material.Neon
    hitboxPart.Parent = workspace
    
    -- –°–æ–∑–¥–∞—ë–º Attachment –¥–ª—è ForceField —ç—Ñ—Ñ–µ–∫—Ç–∞
    local attachment = Instance.new("Attachment")
    attachment.Parent = hitboxPart
    
    -- –î–æ–±–∞–≤–ª—è–µ–º ForceField —ç—Ñ—Ñ–µ–∫—Ç
    local forceField = Instance.new("ForceField")
    forceField.Visible = Settings.VisualizerEnabled
    forceField.Parent = hitboxPart
end

local function destroyHitbox()
    if hitboxPart then
        hitboxPart:Destroy()
        hitboxPart = nil
    end
end

local function checkAndAffectBalls()
    if not Settings.HitboxEnabled or not LocalPlayer.Character then return end
    
    local character = LocalPlayer.Character
    local humanoidRootPart = character:FindFirstChild("HumanoidRootPart")
    if not humanoidRootPart then return end
    
    local hitboxPosition = humanoidRootPart.Position
    local now = tick()
    
    -- –ü—Ä–æ–≤–µ—Ä—è–µ–º –≤—Å–µ —á–∞—Å—Ç–∏ –≤ —Ä–∞–¥–∏—É—Å–µ
    for _, part in pairs(workspace:GetPartsInPart(hitboxPart)) do
        if part and part:IsA("BasePart") and isBall(part) then
            -- –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫—É–ª–¥–∞—É–Ω
            local lastHit = perBallLast[part]
            if lastHit and (now - lastHit) < Settings.PerBallCooldown then
                continue
            end
            
            perBallLast[part] = now
            
            -- GK –ª–æ–≥–∏–∫–∞
            if Settings.GKMode then
                local function findMyGoal()
                    for _, obj in pairs(workspace:GetChildren()) do
                        if obj.Name == "Goal" or obj.Name:find("Goal") then
                            for _, part in pairs(obj:GetDescendants()) do
                                if part:IsA("BasePart") and part.Name == "GoalieCenter" then
                                    return part
                                end
                            end
                        end
                    end
                    return nil
                end
                
                local myGoal = findMyGoal()
                if myGoal then
                    local ballVel = getBallVelocity(part)
                    local toGoal = (myGoal.Position - part.Position)
                    
                    if toGoal.Magnitude > 0 and ballVel.Magnitude > Settings.GK_MinBallSpeed then
                        local ballDir = ballVel.Unit
                        local goalDir = toGoal.Unit
                        local dot = ballDir:Dot(goalDir)
                        
                        local distToGoal = (humanoidRootPart.Position - myGoal.Position).Magnitude
                        
                        if dot >= Settings.GK_DotThreshold and distToGoal < Settings.GK_MaxDistanceToAttempt then
                            local saveDir = (part.Position - myGoal.Position).Unit
                            saveDir = Vector3.new(saveDir.X, 0.35, saveDir.Z).Unit
                            
                            pcall(function()
                                part.AssemblyLinearVelocity = saveDir * Settings.GK_SaveSpeed
                            end)
                            
                            if activeBV[part] then
                                pcall(function() activeBV[part]:Destroy() end)
                                activeBV[part] = nil
                            end
                            
                            Rayfield:Notify({
                                Title = "ü•Ö GK Save", 
                                Content = "Ball deflected!", 
                                Duration = 1
                            })
                            continue
                        end
                    end
                end
            end
            
            -- Magnet –ª–æ–≥–∏–∫–∞
            local targetPos = humanoidRootPart.Position + Vector3.new(0, 1.5, 0)
            local dir = (targetPos - part.Position)
            
            if dir.Magnitude > 0.1 then
                local dirUnit = dir.Unit
                
                if Settings.HitboxUseBodyVelocity then
                    local existingBV = part:FindFirstChild("RSS_HitBV")
                    if not existingBV then
                        local bv = Instance.new("BodyVelocity")
                        bv.Name = "RSS_HitBV"
                        bv.MaxForce = Vector3.new(400000, 400000, 400000)
                        bv.Velocity = dirUnit * Settings.HitboxStrength
                        bv.Parent = part
                        activeBV[part] = bv
                        
                        delay(0.25, function()
                            if bv and bv.Parent then
                                pcall(function() bv:Destroy() end)
                            end
                            activeBV[part] = nil
                        end)
                    else
                        pcall(function()
                            existingBV.Velocity = dirUnit * Settings.HitboxStrength
                        end)
                    end
                else
                    pcall(function()
                        part.AssemblyLinearVelocity = dirUnit * Settings.HitboxStrength
                    end)
                end
            end
        end
    end
end

local function startUpdater()
    if connection then 
        connection:Disconnect() 
        connection = nil
    end
    
    createHitbox()
    
    connection = RunService.Heartbeat:Connect(function()
        if not Settings.HitboxEnabled or not LocalPlayer.Character then 
            if hitboxPart then
                hitboxPart.Transparency = 1
            end
            return 
        end
        
        local character = LocalPlayer.Character
        local humanoidRootPart = character:FindFirstChild("HumanoidRootPart")
        if not humanoidRootPart then return end
        
        -- –û–±–Ω–æ–≤–ª—è–µ–º –ø–æ–∑–∏—Ü–∏—é –∏ –≤–∏–¥–∏–º–æ—Å—Ç—å —Ö–∏—Ç–±–æ–∫—Å–∞
        if hitboxPart then
            hitboxPart.Position = humanoidRootPart.Position
            hitboxPart.Size = Vector3.new(Settings.HitboxRadius * 2, Settings.HitboxRadius * 2, Settings.HitboxRadius * 2)
            hitboxPart.Transparency = Settings.VisualizerEnabled and 0.5 or 1
            
            -- –û–±–Ω–æ–≤–ª—è–µ–º ForceField –≤–∏–¥–∏–º–æ—Å—Ç—å
            local forceField = hitboxPart:FindFirstChild("ForceField")
            if forceField then
                forceField.Visible = Settings.VisualizerEnabled
            end
        end
        
        -- –ü—Ä–æ–≤–µ—Ä—è–µ–º –∏ –≤–æ–∑–¥–µ–π—Å—Ç–≤—É–µ–º –Ω–∞ –º—è—á–∏
        checkAndAffectBalls()
    end)
end

local function stopUpdater()
    if connection then 
        connection:Disconnect() 
        connection = nil
    end
    destroyHitbox()
    
    -- –û—á–∏—â–∞–µ–º –≤—Å–µ BodyVelocity
    for ball, bv in pairs(activeBV) do
        if bv and bv.Parent then
            pcall(function() bv:Destroy() end)
        end
    end
    activeBV = {}
    perBallLast = {}
end

-- UI Elements
Tab:CreateToggle({
    Name = "üß≤ –í–∫–ª—é—á–∏—Ç—å Hitbox",
    CurrentValue = false,
    Callback = function(val)
        Settings.HitboxEnabled = val
        if val then
            startUpdater()
            Rayfield:Notify({
                Title = "Hitbox", 
                Content = "Enabled", 
                Duration = 1
            })
        else
            stopUpdater()
            Rayfield:Notify({
                Title = "Hitbox", 
                Content = "Disabled", 
                Duration = 1
            })
        end
    end
})

Tab:CreateToggle({
    Name = "üëÅÔ∏è –ü–æ–∫–∞–∑–∞—Ç—å –•–∏—Ç–±–æ–∫—Å (Visualizer)",
    CurrentValue = true,
    Callback = function(val)
        Settings.VisualizerEnabled = val
        if hitboxPart then
            hitboxPart.Transparency = val and 0.5 or 1
            local forceField = hitboxPart:FindFirstChild("ForceField")
            if forceField then
                forceField.Visible = val
            end
        end
    end
})

Tab:CreateSlider({
    Name = "üìè –†–∞–¥–∏—É—Å —Ö–∏—Ç–±–æ–∫—Å–∞",
    Range = {3, 30},
    Increment = 1,
    CurrentValue = Settings.HitboxRadius,
    Callback = function(v)
        Settings.HitboxRadius = v
        if hitboxPart then 
            hitboxPart.Size = Vector3.new(v * 2, v * 2, v * 2) 
        end
    end
})

Tab:CreateSlider({
    Name = "üí™ –°–∏–ª–∞ –ø—Ä–∏—Ç—è–∂–µ–Ω–∏—è",
    Range = {20, 200},
    Increment = 5,
    CurrentValue = Settings.HitboxStrength,
    Callback = function(v) 
        Settings.HitboxStrength = v 
    end
})

Tab:CreateToggle({
    Name = "–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å BodyVelocity",
    CurrentValue = Settings.HitboxUseBodyVelocity,
    Callback = function(v) 
        Settings.HitboxUseBodyVelocity = v 
    end
})

Tab:CreateSlider({
    Name = "üïí –ö—É–ª–¥–∞—É–Ω –Ω–∞ –º—è—á",
    Range = {0.1, 2},
    Increment = 0.05,
    CurrentValue = Settings.PerBallCooldown,
    Callback = function(v) 
        Settings.PerBallCooldown = v 
    end
})

TabGK:CreateToggle({
    Name = "ü•Ö –†–µ–∂–∏–º –≤—Ä–∞—Ç–∞—Ä—è (GK)",
    CurrentValue = Settings.GKMode,
    Callback = function(v) 
        Settings.GKMode = v 
    end
})

TabGK:CreateSlider({
    Name = "üí® –°–∫–æ—Ä–æ—Å—Ç—å —Å–µ–π–≤–∞",
    Range = {50, 250},
    Increment = 5,
    CurrentValue = Settings.GK_SaveSpeed,
    Callback = function(v) 
        Settings.GK_SaveSpeed = v 
    end
})

TabGK:CreateSlider({
    Name = "üìè –ú–∞–∫—Å. –¥–∏—Å—Ç–∞–Ω—Ü–∏—è –¥–ª—è —Å–µ–π–≤–∞",
    Range = {5, 50},
    Increment = 1,
    CurrentValue = Settings.GK_MaxDistanceToAttempt,
    Callback = function(v) 
        Settings.GK_MaxDistanceToAttempt = v 
    end
})

-- Cleanup
game:BindToClose(function()
    stopUpdater()
end)

Rayfield:Notify({
    Title = "Script Loaded", 
    Content = "Enhanced by Replit Agent", 
    Duration = 3
})
